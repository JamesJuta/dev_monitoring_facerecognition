<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Table Display</title>

    <!-- Include Tabulator CSS and JS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom-style.css') }}">
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabulator_bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabulator.min.css') }}">
    <link rel="stylesheet" href="https://unpkg.com/tabulator-tables@5.1.5/dist/css/tabulator.min.css">
    <script type="text/javascript" src="https://unpkg.com/tabulator-tables@5.1.5/dist/js/tabulator.min.js"></script>
    <script src="{{ url_for('static', filename='js/tabulator.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <!-- Include date range picker -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.css" />
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker@3.1.0/daterangepicker.js"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/daterange_picker.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-datetimepicker.min.css') }}">
    <!-- <script src="{{ url_for('static', filename='js/bootstrap-datetimepicker.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/daterangepicker.js') }}"></script> -->

    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap-datetimepicker.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom-sweetalert.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dropify.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/fontawesome.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/jquery.timepicker.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main-style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/selectize.bootstrap5.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabulator_bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tabulator.min.css') }}">

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/bootstrap-datetimepicker.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/clipboard.min') }}"></script>
    <script src="{{ url_for('static', filename='js/dropify.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.dataTables.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.timepicker.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/luxon.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main-script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/moment-timezone-with-data.js') }}"></script>
    <script src="{{ url_for('static', filename='js/moment.js') }}"></script>
    <script src="{{ url_for('static', filename='js/selectize.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/sweetalert2.js') }}"></script>
    <script src="{{ url_for('static', filename='js/tabulator.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/theme.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>



    <style>
        /* Include your custom CSS styles here */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        .custom-tabulator {
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            font-family: 'Poppins', sans-serif;
        }

        .custom-tabulator .tabulator-header {
            background-color: #ffffff;
            color: black;
        }
        .custom-tabulator .tabulator-footer {
            background-color: #ffffff;
            color: black;
        }

        .custom-tabulator .tabulator-row {
            background-color: #fff;
        }

        /* .custom-tabulator .tabulator-row:nth-child(even) {
            background-color: #f2f2f2;
        } */

        .custom-tabulator .tabulator-cell {
            padding: 10px;
        }

        .custom-tabulator .tabulator-cell {
            padding: 10px;
        }

      
    </style>
</head>
<body d-flex flex-column h-100vh>

     <nav>

        <div class="logocontainer">
            <!-- <img src="img/logo.png" class="logopic" alt=""> -->
            <i class='scanner bx bx-scan'></i>
            E-<strong>Monitoring</strong>
        </div>
        <input id="nav-toggle" type="checkbox">

        <!-- nav links -->
        <ul class="links">
            <li><a href="">Home</a></li>
            <li><a class="active" href="">Time Log</a></li>
            <li><a href="">Face Register</a></li>
        </ul>

        <!-- burger icon -->
        <label for="nav-toggle" class="icon-burger">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </label>

        <!-- search icon -->
        <!-- <div class="search-box">
                <input class="search-txt" type="text" name="" placeholder="Type to search">
                <a class="search-btn" href="#"><i class="fas fa-search"></i></a>
            </div> -->

        <!-- <a href="">button</a> -->

    </nav>
<!-- 
    <nav class="navbar navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
            <img src="/docs/5.0/assets/brand/bootstrap-logo.svg" alt="" width="30" height="24" class="d-inline-block align-text-top">
            Bootstrap
            </a>
        </div>
        </nav> -->


    <div class="container">
        <div class="row" style="padding:10px;">
            <div class="col-12">
                <div class="data_table">
                    <div class="container_header">
                        <i class='scan bx bx-time'></i>
                        <strong>Today Scan</strong>
                        <!-- Include a search input for the date range picker -->
                        <!-- <input type="text" id="dateRangePicker" /> -->


                        <div class="form-group float-end mb-2" style="margin-left:auto;" id="DateDemo">
                            <i class='bx bx-calendar'></i>
                            <label for="exampleDataList" class="form-label"><b>Filter by</b></label>
                            <input type="text" id="date_range" name="date_range" class="form-control  " style="width:300px;" value="{{ current_date }}" placeholder="Select Date">
                        </div>


                    </div>
                    
                    <div id="time-log-table" class="table table-bordered tabulator"></div>
                    <div>
                        <button type="button" class="btn btn-outline-primary" id="user-download-csv">Download CSV</button>
                        <button type="button" class="btn btn-outline-primary" id="user-download-xlsx">Download XLSX</button>
                        <button type="button" class="btn btn-outline-primary" id="user-print-table">Print</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- <main id="main" class="main">

        <section class="section">
            <div class="card">
                <div class="card-header color-accent-blue-bg text-white fw-semibold d-flex align-items-center justify-content-between flex-wrap" style="font-size: large;">
                    <div>
                        <i class="bi bi-person-circle"></i>&ensp;Today Scan
                    </div>
                    <div class="mt-3 mt-sm-0 mr-auto">
                        <button id="upload_log" class="btn btn-outline-light btn-rounded btn-sm mx-1"><i class="bi bi-cloud-arrow-up"></i> Upload Logs</button>
                        <button id="add_new_user" class="btn btn-outline-light btn-rounded btn-sm mx-1"><i class="bi bi-plus-circle"></i> Add User</button>
                        <button type="button" id="bulk_new_user" class="btn btn-outline-light btn-rounded btn-sm mx-1"><i class="bi bi-arrow-bar-up bulk"></i>&ensp;Add Bulk User</button>
                    </div>
                </div>
                <div class="card-body mt-3 bg-white">
                    <div id="user-table" class="table table-bordered tabulator"></div>
                    <div>
                        <button type="button" class="btn btn-blue btn-sm" id="user-download-csv">Download CSV</button>
                        <button type="button" class="btn btn-blue btn-sm" id="user-download-xlsx">Download XLSX</button>
                        <button type="button" class="btn btn-blue btn-sm" id="user-print-table">Print</button>
                    </div>
                </div>
            </div>
        </section>


    </main> -->

    <!-- <footer>Â© 2023 - 2024 City College of Calamba</footer> -->

    <script>
        // Initialize Tabulator with your data
        // Initialize date range picker
        // $('#dateRangePicker').daterangepicker();

        const table = new Tabulator("#time-log-table", {
            height: "450px",
            printAsHtml: true,
            headerFilterPlaceholder: "Search",
            layout: "fitDataStretch",
            placeholder: "No Data Found",
            placeholderHeaderFilter:"No Matching Data",
            movableColumns: true,
            selectable: true,
            selectableRollingSelection: false,
            headerHozAlign: 'center',
            pagination:true,
            paginationSize:20,
            paginationSizeSelector: [100, 500, 1000, true],
            
            data: {{ data|tojson|safe }},
            columns: [
                {title: "Date", field: "date", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 190},
                {title: "Time", field: "time", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 190},
                {title: "Name", field: "name", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 179},
                {title: "Building Name", field: "building_name", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                        minWidth: 190},
            ],
        });

        // Listen for changes in the date range picker
        // $('#dateRangePicker').on('apply.daterangepicker', function (ev, picker) {
        //     // Get the selected date range
        //     var startDate = picker.startDate.format('YYYY-MM-DD');
        //     var endDate = picker.endDate.format('YYYY-MM-DD');

        //     // Apply the filter to the Tabulator table
        //     table.setFilter([
        //         { field: "date", type: ">=", value: startDate },
        //         { field: "date", type: "<=", value: endDate }
        //     ]);
        // });

        addListener(document.getElementById('user-download-csv'), "click", function() {
            table.download("csv", "user_information_.csv", {
                bom: true
            });
        });

        addListener(document.getElementById('user-download-xlsx'), "click", function() {
            table.download("xlsx", "user_information_.xlsx");
        });

        addListener(document.getElementById('user-print-table'), "click", function() {
            table.print(false, true);
        });



        (function() {
            var datetime = '{{current_datetime}}';
            var global_date = '{{current_date}}+ "@" +{{current_date}}';

            var set_server_time = '{{current_datetime}}';
            var serverOffset = moment(set_server_time).diff(new Date());
            var now_server = moment();
            now_server.add(serverOffset, 'milliseconds');
            var dateLimit = now_server.format('MM-DD-YYYY');

        $('#date_range').daterangepicker({
            opens: 'left',
            maxDate: dateLimit
        }, function(start, end, label) {
            global_date = start.format('YYYY-MM-DD') + "@" + end.format('YYYY-MM-DD');
            table.setData("<?php echo BASE_URL; ?>app_onsite/timeLog_db.php", {
                table: 'master_schedule',
                status: global_date
            });
            table.setSort([{
                    column: "date",
                    dir: "DESC"
                }, //sort by this first
            ]);
        });

        var table = new Tabulator("#example-table", {
            height: "650px",
            printAsHtml: true,
            headerFilterPlaceholder: "",
            layout: "fitDataStretch",
            placeholder: "No Data Found",
            movableColumns: true,
            selectable: false,
            ajaxParams: {
                table: 'time_log',
                status: global_date
            },
            headerHozAlign: 'center',
            ajaxURL: '/display_database_table',
            ajaxConfig: 'GET',
            ajaxContentType: 'json',
            ajaxResponse: function(url, params, response) {
                return response.data;
            },
            ajaxLoaderLoading: 'Fetching data from Database..',
            printConfig: {
                columnGroups: false,
                rowGroups: false,
            },
            pagination: 'remote',
            paginationButtonCount: 5,
            paginationSize: 10,
            ajaxSorting: true,
            ajaxFiltering: true,
            ajaxLoader: true,
            ajaxLoaderLoading: 'Fetching data from Database..',
            paginationSizeSelector: [50, 100, 500, 1000, 2000],
            columns: [{
                    title: "Date",
                    field: "date_log",
                    // headerFilter: "input",
                    // headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    vertAlign: 'middle',
                    formatter: "datetime",
                    formatterParams: {
                        inputFormat: "YYYY-MM-DD",
                        outputFormat: "MM-DD-YYYY",
                        invalidPlaceholder: "--",
                    },
                    headerFilterLiveFilter: false,
                    hozAlign: "center",
                    width: '175'
                },
               


            ],
            ajaxResponse: function(url, params, response) {
                //url - the URL of the request
                //params - the parameters passed with the request
                //response - the JSON object returned in the body of the response.
                return response; //return the tableData property of a response json object
            },

        });

        //trigger download of timelog.csv file
        document.getElementById("download-csv").addEventListener("click", function() {
            table.download("csv", "timelog_" + datetime + ".csv", {
                bom: true
            });
        });

        //trigger download of timelog.xlsx file
        document.getElementById("download-xlsx").addEventListener("click", function() {
            table.download("xlsx", "timelog_" + datetime + ".xlsx", {
                sheetName: "My Data"
            });
        });

        //trigger download of timelog.xlsx file
        document.getElementById("print-table").addEventListener("click", function() {
            table.print(false, true);
        });
    })();
    </script>  
    
    
    

</body>
</html>
