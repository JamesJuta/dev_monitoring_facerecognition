<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Table Example with Tabulator and AJAX</title>
    <link href='https://unpkg.com/boxicons@2.1.1/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="	https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script> -->
    <link href="https://cdn.jsdelivr.net/npm/tabulator-tables@5.0.0/dist/css/tabulator.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/tabulator_bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/bootstrap-datetimepicker.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename = 'css/daterange_picker.css') }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename = 'js/moment.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/tabulator.min.js') }}"></script>
    <script src="{{ url_for('static', filename = 'js/daterangepicker.js') }}"></script>
    <style>
        /* Customize Tabulator pagination styles */
        
        .tabulator .tabulator-footer .tabulator-page {
            background-color: white; /* Change to your desired color */
            color: #1A73E8; /* Change to your desired text color */
            border: 1px solid #1A73E8; /* Change to your desired border color */
        }

        .tabulator .tabulator-footer .tabulator-page:hover {
            background-color: #2980b9; /* Change to your desired hover color */
        }
        .tabulator .tabulator-footer {
            background-color: #ffffff; /* Set to white or your desired color */
        }
        /* Remove stripes from Tabulator rows */
        .tabulator-row {
            background-color: #ffffff; /* Set background color to white or your desired color */
        }
        /* Style even and odd rows differently if needed */
        .tabulator-row:nth-child(even) {
            background-color: #ffffff; /* Set background color for even rows */
        }

    </style>
</head>

<body class="d-flex flex-column h-100vh" style="background-color: #f5f8fe;">

    <nav class="navbar sticky-top bg-body-tertiary shadow-sm p-3">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/docs/5.3/assets/brand/bootstrap-logo.svg" alt="" width="30" height="24" class="d-inline-block align-text-top">
                <span class="navbar-brand mb-0 h1 text-primary">E-Monitoring</span>
            </a>
            <ul class="nav nav-underline">
                <li class="nav-item">
                    <a class="nav-link" href="#">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Time Log</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Face Register</a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="row" style="padding: 20px;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white fw-semibold d-flex align-items-center justify-content-between flex-wrap" style=" height: 70px;">
                        <h4 class="p-2 text-white"><i class='bx bx-time'></i> <b>Time Log</b></h4>
                        <div class="p-2 d-flex" style="margin-left:auto;" id="DateDemo">
                            <label for="exampleDataList" class="form-label p-2 text-white"> <i class='bx bx-calendar'></i> Filter by</label>
                            <input type="text" id="date_range" name="date_range" class="form-control p-2 " style="width:200px; height: 35px;" value="{{current_date}}" placeholder="Select Date">
                        </div><br>
                    </div>
                    <div class="card-body mt-1 bg-white">
                        <div id="example-table" class="table table-sm tabulator"></div>
                        <div>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="download-csv">Download CSV</button>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="download-xlsx">Download XLSX</button>
                            <button type="button" class="btn btn-outline-primary btn-sm" id="print-table">Print</button>
                        </div>
                    </div>
                    
                </div>
            </div>
        </div>
    </div>
    
    <footer class="text-center text-white p-3" style="background-color:#2f2f41;">Â© 2023 - 2024 City College of Calamba</footer>


    <script>
        // (function () {
           
           

        //     // //trigger download of timelog.csv file
        //     // document.getElementById("download-csv").addEventListener("click", function () {
        //     //     table.download("csv", "timelog_" + datetime + ".csv", {
        //     //         bom: true
        //     //     });
        //     // });

        //     // //trigger download of timelog.xlsx file
        //     // document.getElementById("download-xlsx").addEventListener("click", function () {
        //     //     table.download("xlsx", "timelog_" + datetime + ".xlsx", {
        //     //         sheetName: "My Data"
        //     //     });
        //     // });

        //     // //trigger download of timelog.xlsx file
        //     // document.getElementById("print-table").addEventListener("click", function () {
        //     //     table.print(false, true);
        //     // });
        // });

         var datetime = '{{current_datetime}}'
            var global_date = '{{ initial_date_range }}';
            var set_server_time = '{{current_datetime}}'
            var serverOffset = moment(set_server_time).diff(new Date());
            var now_server = moment();
            now_server.add(serverOffset, 'milliseconds');
            var dateLimit = now_server.format('MM-DD-YYYY');

            $('#date_range').daterangepicker({
                opens: 'left',
                maxDate: dateLimit
            }, function (start, end, label) {
                global_date = start.format('YYYY-MM-DD') + "@" + end.format('YYYY-MM-DD');
                table.setData("/get_data", {
                    table: 'master_schedule',
                    status: global_date
                });
                table.setSort([{
                    column: "date",
                    dir: "DESC"
                }, //sort by this first
                ]);
            });

            var table = new Tabulator('#example-table', {
            height: "350px",
            printAsHtml: true,
            headerFilterPlaceholder: "Search",
            layout: 'fitDataStretch',
            placeholder: 'No Data Found',
            ajaxURL: '/get_data',
            ajaxParams: {
                table: 'master_schedule',
                status: global_date
            },
            pagination: 'remote',
            paginationButtonCount: 5,
            paginationSize: 20,
            ajaxSorting: true,
            ajaxFiltering: true,
            ajaxLoader: true,
            ajaxLoaderLoading: 'Fetching data from Database..',
            paginationSizeSelector: [50, 100, 500, 1000, 2000],
            columns: [
                {title: "Date", field: "date", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 250},
                {title: "Time", field: "time", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 250},
                {title: "Name", field: "name", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                    minWidth: 250},
                {title: "Building Name", field: "building_name", 
                    headerFilter: "input",
                    headerFilterFunc: "like",
                    headerFilterParams: {
                        allowEmpty: true
                    },
                    headerFilterLiveFilter: false,
                    formatter: 'textarea',
                    vertAlign: 'middle',
                        minWidth: 250},
            ],
            ajaxResponse: function (url, params, response) {
                return response.data
            },
        });
    </script>
</body>

</html>